box: golang

build:
  steps:
    - script:
        name: Download
        code: curl -L https://github.com/spf13/hugo/releases/download/v0.16/hugo_0.16_linux_amd64.tar.gz | tar zxvf -
    - script:
        name: Build ja/
        code: |
          cd $WERCKER_ROOT/ja
          $WERCKER_ROOT/hugo_0.16_linux_amd64/hugo_0.16_linux_amd64
          cp -r $WERCKER_ROOT/ja/public $WERCKER_OUTPUT_DIR/ja
    - script:
        name: Build en/
        code: |
          cd $WERCKER_ROOT/en
          $WERCKER_ROOT/hugo_0.16_linux_amd64/hugo_0.16_linux_amd64
          cp -r $WERCKER_ROOT/en/public $WERCKER_OUTPUT_DIR/en
    - script:
        name: Hide en/ for a moment
        code: |
          echo > $WERCKER_OUTPUT_DIR/en/index.html

deploy:
  steps:
    - s3sync:
        delete-removed: true
        bucket-url: $AWS_BUCKET_URL
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
