box: node:8.5-slim

build:
  steps:
    - npm-install
    - script:
        name: Download Hugo
        code: |
          apt-get install -y make wget
          wget -O - https://github.com/spf13/hugo/releases/download/v0.16/hugo_0.16_linux-64bit.tgz | tar zxvf -
    - script:
        name: Build static files
        code: |
          cd $WERCKER_ROOT
          make
    - script:
        name: Build ja/
        code: |
          cd $WERCKER_ROOT/ja
          $WERCKER_ROOT/hugo
          cp -r $WERCKER_ROOT/ja/public $WERCKER_OUTPUT_DIR/ja
    - script:
        name: Build en/
        code: |
          cd $WERCKER_ROOT/en
          $WERCKER_ROOT/hugo
          cp -r $WERCKER_ROOT/en/public $WERCKER_OUTPUT_DIR/en

deploy:
  steps:
    - script:
        name: Install s3cmd
        code: apt-get install -y s3cmd
    - s3sync:
        delete-removed: true
        bucket-url: $AWS_BUCKET_URL
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
